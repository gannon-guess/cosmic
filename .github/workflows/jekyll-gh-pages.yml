deploy:
  environment:
    name: github-pages
    url: ${{ steps.deployment.outputs.page_url }}
  runs-on: ubuntu-latest
  needs: build
  steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # Ensures we get all branches

    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4

    - name: Push to gh-pages branch
      run: |
        git config --global user.email "actions@github.com"
        git config --global user.name "GitHub Actions"

        # Ensure we are inside a valid Git repository
        git init
        git remote add origin https://github.com/${{ github.repository }}.git
        git fetch origin
        git checkout --orphan gh-pages
        git rm -rf .

        # Move built Jekyll site into place
        mv _site/* .

        git add .
        git commit -m "Deploy Jekyll site"
        git push -f origin gh-pages
